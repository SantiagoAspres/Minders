/*! For license information please see my-sdk.esm.js.LICENSE.txt */
import{default as e}from"vue";import{default as t}from"vuetify";var n=function(){var e=this,t=e._self._c;return t("div",[t("v-btn",{staticStyle:{color:"white","background-color":"#1976D2"},attrs:{small:"","aria-label":"Abrir Formulario de Feedback"},on:{click:e.abrirModal}},[t("span",[e._v("Abrir Modal")])]),e._v(" "),t("v-dialog",{attrs:{"max-width":"400",persistent:""},model:{value:e.isModalVisible,callback:function(t){e.isModalVisible=t},expression:"isModalVisible"}},[t("v-card",{staticClass:"rounded-lg"},[t("v-card-title",{staticClass:"headline",staticStyle:{"background-color":"#1976D2",color:"white"}},[e._v("\n        Enviar Feedback\n      ")]),e._v(" "),t("v-card-text",{staticClass:"pt-4 pb-2",staticStyle:{"font-family":"Roboto, sans-serif","font-weight":"500"}},[t("p",{staticClass:"font-weight-medium mb-1"},[e._v("calificación:")]),e._v(" "),t("v-rating",{attrs:{length:5,hover:"",size:"32",color:"#FFC107","background-color":"#616161"},model:{value:e.rating,callback:function(t){e.rating=t},expression:"rating"}}),e._v(" "),t("v-textarea",{staticClass:"mt-3",attrs:{label:"Comentario",rows:"3",outlined:"",clearable:"","error-messages":e.error?"Error al enviar: "+e.error:""},model:{value:e.comment,callback:function(t){e.comment=t},expression:"comment"}}),e._v(" "),e.successMessage?t("v-alert",{attrs:{type:"success",dense:"",dismissible:""}},[e._v("Gracias! Tu feedback ha sido enviado.\n        ")]):e._e(),e._v(" "),e.error?t("v-alert",{attrs:{type:"error",dense:"",dismissible:""}},[e._v(e._s(e.error))]):e._e()],1),e._v(" "),t("v-card-actions",[t("v-spacer"),e._v(" "),t("v-btn",{attrs:{color:"secondary",text:"",disabled:e.isLoading},on:{click:e.cerrarModal}},[e._v("Cancelar")]),e._v(" "),t("v-btn",{staticStyle:{color:"white","background-color":"#1976D2"},attrs:{loading:e.isLoading,disabled:!e.rating||e.isLoading||e.isClosing},on:{click:e.submitForm}},[e._v("\n          Enviar Feedback\n        ")])],1)],1)],1)],1)};function r(){var e,t,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",a=n.toStringTag||"@@toStringTag";function c(n,r,i,a){var c=r&&r.prototype instanceof s?r:s,l=Object.create(c.prototype);return o(l,"_invoke",function(n,r,o){var i,a,c,s=0,l=o||[],f=!1,d={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return i=t,a=0,c=e,d.n=n,u}};function p(n,r){for(a=n,c=r,t=0;!f&&s&&!o&&t<l.length;t++){var o,i=l[t],p=d.p,v=i[2];n>3?(o=v===r)&&(c=i[(a=i[4])?5:(a=3,3)],i[4]=i[5]=e):i[0]<=p&&((o=n<2&&p<i[1])?(a=0,d.v=r,d.n=i[1]):p<v&&(o=n<3||i[0]>r||r>v)&&(i[4]=n,i[5]=r,d.n=v,a=0))}if(o||n>1)return u;throw f=!0,r}return function(o,l,v){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&p(l,v),a=l,c=v;(t=a<2?e:c)||!f;){i||(a?a<3?(a>1&&(d.n=-1),p(a,c)):d.n=c:d.v=c);try{if(s=2,i){if(a||(o="next"),t=i[o]){if(!(t=t.call(i,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,a<2&&(a=0)}else 1===a&&(t=i.return)&&t.call(i),a<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),a=1);i=e}else if((t=(f=d.n<0)?c:n.call(r,d))!==u)break}catch(t){i=e,a=1,c=t}finally{s=1}}return{value:t,done:f}}}(n,i,a),!0),l}var u={};function s(){}function l(){}function f(){}t=Object.getPrototypeOf;var d=[][i]?t(t([][i]())):(o(t={},i,function(){return this}),t),p=f.prototype=s.prototype=Object.create(d);function v(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,o(e,a,"GeneratorFunction")),e.prototype=Object.create(p),e}return l.prototype=f,o(p,"constructor",f),o(f,"constructor",l),l.displayName="GeneratorFunction",o(f,a,"GeneratorFunction"),o(p),o(p,a,"Generator"),o(p,i,function(){return this}),o(p,"toString",function(){return"[object Generator]"}),(r=function(){return{w:c,m:v}})()}function o(e,t,n,r){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}o=function(e,t,n,r){function a(t,n){o(e,t,function(e){return this._invoke(t,n,e)})}t?i?i(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(a("next",0),a("throw",1),a("return",2))},o(e,t,n,r)}function i(e,t,n,r,o,i,a){try{var c=e[i](a),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(r,o)}n._withStripped=!0;var a=function(e,t){var n,r=e;if(t&&(r.render=t,r.staticRenderFns=[],r._compiled=!0),n)if(r.functional){r._injectStyles=n;var o=r.render;r.render=function(e,t){return n.call(t),o(e,t)}}else{var i=r.beforeCreate;r.beforeCreate=i?[].concat(i,n):[n]}return{exports:e,options:r}}({props:{onSubmitFeedback:{type:Function,required:!0},onOpenModal:{type:Function,required:!0}},data:function(){return{isModalVisible:!1,rating:0,comment:"",isLoading:!1,isClosing:!1,error:null,successMessage:null}},mounted:function(){this.onOpenModal(this.abrirModal)},methods:{abrirModal:function(){this.isModalVisible=!0,this.resetForm()},cerrarModal:function(){var e=this;this.isClosing=!0,this.isModalVisible=!1,setTimeout(function(){e.resetForm(),e.isClosing=!1},300)},resetForm:function(){this.rating=0,this.comment="",this.error=null,this.successMessage=null},submitForm:function(){var e,t=this;return(e=r().m(function e(){var n,o;return r().w(function(e){for(;;)switch(e.p=e.n){case 0:if(t.rating){e.n=1;break}return t.error="Por favor, selecciona una calificación.",e.a(2);case 1:return t.isLoading=!0,t.error=null,t.successMessage=null,e.p=2,n={rating:t.rating,comment:(t.comment||"").trim()},e.n=3,t.onSubmitFeedback(n);case 3:t.successMessage="¡Gracias! Tu feedback ha sido enviado.",t.isClosing=!0,setTimeout(function(){t.cerrarModal()},1500),e.n=5;break;case 4:e.p=4,o=e.v,t.error=o.message||"Ocurrió un error desconocido al enviar.";case 5:return e.p=5,t.isLoading=!1,e.f(5);case 6:return e.a(2)}},e,null,[[2,4,5,6]])}),function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function c(e){i(a,r,o,c,u,"next",e)}function u(e){i(a,r,o,c,u,"throw",e)}c(void 0)})})()}}},n);const c=a.exports;function u(e){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u(e)}function s(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var u=r&&r.prototype instanceof c?r:c,s=Object.create(u.prototype);return l(s,"_invoke",function(n,r,o){var i,c,u,s=0,l=o||[],f=!1,d={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return i=t,c=0,u=e,d.n=n,a}};function p(n,r){for(c=n,u=r,t=0;!f&&s&&!o&&t<l.length;t++){var o,i=l[t],p=d.p,v=i[2];n>3?(o=v===r)&&(u=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=e):i[0]<=p&&((o=n<2&&p<i[1])?(c=0,d.v=r,d.n=i[1]):p<v&&(o=n<3||i[0]>r||r>v)&&(i[4]=n,i[5]=r,d.n=v,c=0))}if(o||n>1)return a;throw f=!0,r}return function(o,l,v){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&p(l,v),c=l,u=v;(t=c<2?e:u)||!f;){i||(c?c<3?(c>1&&(d.n=-1),p(c,u)):d.n=u:d.v=u);try{if(s=2,i){if(c||(o="next"),t=i[o]){if(!(t=t.call(i,u)))throw TypeError("iterator result is not an object");if(!t.done)return t;u=t.value,c<2&&(c=0)}else 1===c&&(t=i.return)&&t.call(i),c<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),c=1);i=e}else if((t=(f=d.n<0)?u:n.call(r,d))!==a)break}catch(t){i=e,c=1,u=t}finally{s=1}}return{value:t,done:f}}}(n,o,i),!0),s}var a={};function c(){}function u(){}function f(){}t=Object.getPrototypeOf;var d=[][r]?t(t([][r]())):(l(t={},r,function(){return this}),t),p=f.prototype=c.prototype=Object.create(d);function v(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,l(e,o,"GeneratorFunction")),e.prototype=Object.create(p),e}return u.prototype=f,l(p,"constructor",f),l(f,"constructor",u),u.displayName="GeneratorFunction",l(f,o,"GeneratorFunction"),l(p),l(p,o,"Generator"),l(p,r,function(){return this}),l(p,"toString",function(){return"[object Generator]"}),(s=function(){return{w:i,m:v}})()}function l(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}l=function(e,t,n,r){function i(t,n){l(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(i("next",0),i("throw",1),i("return",2))},l(e,t,n,r)}function f(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function d(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?f(Object(n),!0).forEach(function(t){w(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):f(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function p(e,t,n,r,o,i,a){try{var c=e[i](a),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(r,o)}function v(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){p(i,r,o,a,c,"next",e)}function c(e){p(i,r,o,a,c,"throw",e)}a(void 0)})}}function b(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,O(r.key),r)}}function h(e){var t="function"==typeof Map?new Map:void 0;return h=function(e){if(null===e||!function(e){try{return-1!==Function.toString.call(e).indexOf("[native code]")}catch(t){return"function"==typeof e}}(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return function(e,t,n){if(y())return Reflect.construct.apply(null,arguments);var r=[null];r.push.apply(r,t);var o=new(e.bind.apply(e,r));return n&&m(o,n.prototype),o}(e,arguments,g(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),m(n,e)},h(e)}function y(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(y=function(){return!!e})()}function m(e,t){return m=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},m(e,t)}function g(e){return g=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},g(e)}function w(e,t,n){return(t=O(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function O(e){var t=function(e){if("object"!=u(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=u(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==u(t)?t:t+""}var j=null;if("undefined"!=typeof window&&"undefined"!=typeof document){e.use(t);var k=function(){function n(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),w(e=function(e,t,n){return t=g(t),function(e,t){if(t&&("object"==u(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,y()?Reflect.construct(t,n||[],g(e).constructor):t.apply(e,n))}(this,n),"config",{projectId:null,apiKey:null,apiUrl:"https://api.myfeedbackservice.com/submit",debug:!1}),w(e,"vueInstance",null),w(e,"userId",null),w(e,"isReady",!1),w(e,"openModalHandler",null),w(e,"queue",[]),e.attachShadow({mode:"open"}),e.userId=function(){var e="sdk_user_id";if("undefined"==typeof localStorage)return"user-temp-fallback";var t=localStorage.getItem(e);return t||(t="user-"+Date.now()+Math.random().toString(36).substr(2,9),localStorage.setItem(e,t)),t}(),window.addEventListener("online",function(){e.queue.length>0&&e.config.debug&&console.log("Reconnected. Flush queue."),e._flushQueue()}),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&m(e,t)}(n,h(HTMLElement)),r=n,o=[{key:"setOpenModalHandler",value:function(e){this.openModalHandler=e}},{key:"initialize",value:function(e){this.config=Object.assign(this.config,e),this.queue=[],this.config.apiKey||console.error("SDK Error: apiKey no proporcionada"),this.config.projectId||console.error("SDK Error: projectId no proporcionado"),this.config.debug&&console.log("SDK initialized:",this.config)}},{key:"connectedCallback",value:function(){var n=this;!function(e){var t=document.createElement("link");t.rel="stylesheet",t.href="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.min.css",e.appendChild(t);var n=document.createElement("link");n.rel="stylesheet",n.href="https://cdn.jsdelivr.net/npm/@mdi/font@4.x/css/materialdesignicons.min.css",e.appendChild(n)}(this.shadowRoot);var r=document.createElement("div");r.id="app",this.shadowRoot.appendChild(r);var o=this.submitFeedback.bind(this),i=this.setOpenModalHandler.bind(this);this.vueInstance=new e({vuetify:new t({icons:{iconfont:"mdi"}}),render:function(e){return e(c,{props:{onSubmitFeedback:o,onOpenModal:i}})}}).$mount(r),this.vueInstance.$nextTick(function(){n.isReady=!0,n.config.debug&&console.log("SDK: Componente Vue montado y listo."),n.dispatchEvent(new CustomEvent("sdk-ready",{bubbles:!0,composed:!0}))})}},{key:"openModal",value:function(){this.isReady&&this.openModalHandler?this.openModalHandler():console.error("SDK Error: componente Vue no listo o llamado demasiado pronto.")}},{key:"submitFeedback",value:(l=v(s().m(function e(t){var n;return s().w(function(e){for(;;)switch(e.n){case 0:if(n=d(d({},t),{},{user_id:this.userId,project_id:this.config.projectId,timestamp:(new Date).toISOString(),extra:{app_version:"1.0.0",user_agent:navigator.userAgent,url_actual:window.location.href,language:navigator.language}}),navigator.onLine){e.n=1;break}return this.config.debug&&console.warn("Offline: encolando feedback",n),this.queue.push(n),e.a(2,Promise.resolve({queued:!0}));case 1:return e.a(2,this._send(n))}},e,this)})),function(e){return l.apply(this,arguments)})},{key:"_send",value:(a=v(s().m(function e(t){var n,r,o;return s().w(function(e){for(;;)switch(e.p=e.n){case 0:if(this.config.apiKey){e.n=1;break}throw new Error("API Key no configurada. Llama a initialize() primero.");case 1:return this.config.debug&&console.log("Enviando feedback:",t),e.p=2,e.n=3,fetch(this.config.apiUrl,{method:"POST",headers:{"Content-Type":"application/json","X-API-Key":this.config.apiKey},body:JSON.stringify(t)});case 3:if((n=e.v).ok){e.n=5;break}return e.n=4,n.json().catch(function(){return{message:"Server error"}});case 4:throw r=e.v,new Error("Fallo en la API (".concat(n.status,"): ").concat(r.message||"Error desconocido"));case 5:return this.config.debug&&console.log("Feedback enviado exitosamente",t),e.a(2,n.json());case 6:return e.p=6,o=e.v,this.config.debug&&console.error("Error enviando feedback, encolando",o),this.queue.push(t),e.a(2,Promise.reject(o))}},e,this,[[2,6]])})),function(e){return a.apply(this,arguments)})},{key:"_flushQueue",value:(i=v(s().m(function e(){var t;return s().w(function(e){for(;;)switch(e.p=e.n){case 0:if(!(this.queue.length>0)){e.n=5;break}return t=this.queue.shift(),e.p=1,e.n=2,this._send(t);case 2:e.n=4;break;case 3:return e.p=3,e.v,this.queue.unshift(t),e.a(3,5);case 4:e.n=0;break;case 5:return e.a(2)}},e,this,[[1,3]])})),function(){return i.apply(this,arguments)})}],o&&b(r.prototype,o),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,o,i,a,l}();customElements.define("my-sdk",k),j=k}export{j as MySDK};